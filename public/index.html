<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>盆栽成本记录系统 Lover Legend Gardening</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f7f7f7;
      padding: 0 20px 40px;
      max-width: 800px;
      margin: auto;
    }
    h1 {
      text-align: center;
      margin-top: 10px;
    }
    h2 {
      margin-top: 30px;
      font-size: 20px;
      color: #333;
    }
    label {
      display: block;
      margin: 10px 0 4px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      box-sizing: border-box;
      appearance: textfield;
    }
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input:invalid {
      border: 2px solid red;
    }
    .section {
      margin-top: 40px;
      border-top: 2px solid #ccc;
      padding-top: 20px;
    }
    .logo {
      display: block;
      margin: 20px auto 10px;
      max-height: 60px;
    }
    .link-input {
      word-break: break-all;
    }
  </style>
</head>
<body>
  <img class="logo" src="/logo.png" alt="logo" />
  <h1>盆栽成本记录系统 Lover Legend Gardening</h1>

  <h2>🌱 盆栽资料（含内陆发货信息）</h2>

  <form>
    <label>供应商</label>
    <input type="text" name="supplier" required>

    <label>品种</label>
    <input type="text" name="type" required>

    <label>单价（原币）</label>
    <input type="number" step="0.01" required onblur="formatCurrency(this)">

    <label>币值</label>
    <select required>
      <option>CNY</option>
      <option>VND</option>
      <option>NTD</option>
      <option>IDR</option>
    </select>

    <label>数量（棵）</label>
    <input type="number" min="0" required>

    <label>图片网址（URL）</label>
    <input type="url" class="link-input" onchange="updateLink(this)">
    <div id="urlPreview"></div>

    <label>发货单号</label>
    <input type="text">

    <label>这次发货总数（棵）</label>
    <input type="number" min="0" readonly>

    <label>这次发货总金额（RM）</label>
    <input type="text" readonly>

    <label>包装明细</label>
    <input type="text">

    <label>抵达仓库日期</label>
    <input type="text" placeholder="dd/mm/yyyy" oninput="formatDate(this)">
    
    <div class="section">
      <h2>🚛 发货资料</h2>

      <label>装柜日期</label>
      <input type="text" placeholder="dd/mm/yyyy" id="shipDate" oninput="formatDate(this); calcDays()">

      <label>海运单号</label>
      <input type="text">

      <label>到大马运费（RM）</label>
      <input type="number" step="0.01" id="shippingCost" onblur="formatCurrency(this); calcRatio()">

      <label>抵达大马日期</label>
      <input type="text" placeholder="dd/mm/yyyy" id="arriveDate" oninput="formatDate(this); calcDays()">

      <label>运输天数（自动）</label>
      <input type="text" id="daysResult" readonly>

      <label>运费比例（自动）</label>
      <input type="text" id="ratioResult" readonly>
    </div>
  </form>

  <script>
    function formatCurrency(input) {
      let val = parseFloat(input.value.replace(/,/g, ''));
      if (!isNaN(val)) {
        input.value = val.toLocaleString('en-MY', { minimumFractionDigits: 2 });
      }
    }

    function updateLink(input) {
      const div = document.getElementById('urlPreview');
      div.innerHTML = '';
      if (input.value.startsWith('http')) {
        div.innerHTML = `<a href="${input.value}" target="_blank">点击查看图片</a>`;
      }
    }

    function formatDate(input) {
      let raw = input.value.replace(/[^0-9]/g, '');
      if (raw.length === 6 || raw.length === 8) {
        let d = raw.slice(0, 2);
        let m = raw.slice(2, 4);
        let y = raw.slice(4);
        if (y.length === 2) y = '20' + y;
        input.value = `${d}/${m}/${y}`;
      }
    }

    function calcDays() {
      const ship = document.getElementById('shipDate').value;
      const arrive = document.getElementById('arriveDate').value;
      const out = document.getElementById('daysResult');
      if (/\d{2}\/\d{2}\/\d{4}/.test(ship) && /\d{2}\/\d{2}\/\d{4}/.test(arrive)) {
        const [ds, ms, ys] = ship.split('/');
        const [da, ma, ya] = arrive.split('/');
        const start = new Date(`${ys}-${ms}-${ds}`);
        const end = new Date(`${ya}-${ma}-${da}`);
        const diff = Math.round((end - start) / (1000 * 60 * 60 * 24));
        if (!isNaN(diff)) out.value = diff + ' 天';
      } else {
        out.value = '';
      }
    }

    function calcRatio() {
      const cost = parseFloat(document.getElementById('shippingCost').value.replace(/,/g, ''));
      const totalQty = document.querySelector('input[placeholder="dd/mm/yyyy"]').previousElementSibling.value;
      const out = document.getElementById('ratioResult');
      const qty = parseFloat(totalQty);
      if (!isNaN(cost) && !isNaN(qty) && qty > 0) {
        out.value = (cost / qty).toFixed(2);
      } else {
        out.value = '';
      }
    }
  </script>
</body>
</html>
