<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>盆根成本记录系统 Lover Legend Gardening</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f7f7f7;
      padding: 0 20px 40px;
      max-width: 1000px;
      margin: auto;
    }
    h1 {
      text-align: center;
      margin-top: 10px;
    }
    h2 {
      margin-top: 30px;
      font-size: 20px;
      color: #333;
    }
    label {
      display: block;
      margin: 10px 0 4px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .two-cols {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .section {
      margin-top: 40px;
      border-top: 2px solid #ccc;
      padding-top: 20px;
    }
    .logo {
      display: block;
      margin: 0 auto 10px;
      max-height: 70px;
    }
    a {
      word-break: break-all;
      color: blue;
    }
    .bold-red {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <img class="logo" src="/logo.png" alt="logo" />
  <h1>盆根成本记录系统 Lover Legend Gardening</h1>
  <h2>🌱 盆根资料（含内陆发货信息）</h2>
  <form>
    <div class="two-cols">
      <div>
        <label>供应商</label>
        <textarea required></textarea>
      </div>
      <div>
        <label>品种</label>
        <textarea required></textarea>
      </div>
      <div>
        <label>单价（原币）</label>
        <input type="text" onblur="formatCurrency(this)" required>
      </div>
      <div>
        <label>币值</label>
        <select required>
          <option>CNY</option>
          <option>VND</option>
          <option>NTD</option>
          <option>IDR</option>
        </select>
      </div>
      <div>
        <label>数量（棵）</label>
        <input type="text" onblur="formatCurrency(this)" required>
      </div>
      <div>
        <label>图片网址（URL）</label>
        <a id="imageLink" href="#" target="_blank"></a>
        <input type="url" oninput="updateLink(this)">
      </div>
      <div>
        <label>发货单号</label>
        <input type="text">
      </div>
      <div>
        <label>这次发货总数（棵）</label>
        <input type="text" readonly>
      </div>
      <div>
        <label>这次发货总金额（RM）</label>
        <input type="text" readonly>
      </div>
      <div>
        <label>包装明细</label>
        <textarea></textarea>
      </div>
    </div>
    <div class="section">
      <h2>🚛 发货详情</h2>
      <div class="two-cols">
        <div>
          <label>装柜日期</label>
          <input type="text" id="shipDate" placeholder="dd/mm/yyyy" oninput="formatDate(this); calcDays()">
        </div>
        <div>
          <label>海运单号</label>
          <input type="text">
        </div>
        <div>
          <label>到大马运费（RM）</label>
          <input type="text" id="shippingCost" onblur="formatCurrency(this); calcRatio()">
        </div>
        <div>
          <label>抵达大马日期</label>
          <input type="text" id="arriveDate" placeholder="dd/mm/yyyy" oninput="formatDate(this); calcDays()">
        </div>
        <div>
          <label>运费天数</label>
          <input type="text" id="daysResult" readonly>
        </div>
        <div>
          <label>运费比例</label>
          <input type="text" id="ratioResult" readonly>
        </div>
      </div>
    </div>
  </form>

  <script>
    function formatCurrency(input) {
      let val = parseFloat(input.value.replace(/,/g, ''));
      if (!isNaN(val)) {
        input.value = val.toLocaleString('en-MY', { minimumFractionDigits: 2 });
      }
    }

    function updateLink(input) {
      const link = document.getElementById('imageLink');
      if (input.value.startsWith('http')) {
        link.href = input.value;
        link.textContent = input.value;
      } else {
        link.textContent = '';
        link.href = '#';
      }
    }

    function formatDate(input) {
      let raw = input.value.replace(/[^0-9]/g, '');
      if (raw.length === 6 || raw.length === 8) {
        let d = raw.slice(0, 2);
        let m = raw.slice(2, 4);
        let y = raw.slice(4);
        if (y.length === 2) y = '20' + y;
        input.value = `${d}/${m}/${y}`;
      }
    }

    function calcDays() {
      const ship = document.getElementById('shipDate').value;
      const arrive = document.getElementById('arriveDate').value;
      const out = document.getElementById('daysResult');

      if (ship.match(/\d{2}\/\d{2}\/\d{4}/) && arrive.match(/\d{2}\/\d{2}\/\d{4}/)) {
        const [ds, ms, ys] = ship.split('/');
        const [da, ma, ya] = arrive.split('/');
        const start = new Date(`${ys}-${ms}-${ds}`);
        const end = new Date(`${ya}-${ma}-${da}`);
        const diff = Math.round((end - start) / (1000 * 60 * 60 * 24));
        if (!isNaN(diff)) out.value = diff + ' 天';
      } else {
        out.value = '';
      }
    }

    function calcRatio() {
      const costInput = document.getElementById('shippingCost');
      const cost = parseFloat(costInput.value.replace(/,/g, ''));
      const qty = 1; // placeholder: replace with actual quantity input
      const out = document.getElementById('ratioResult');
      if (!isNaN(cost) && qty > 0) {
        out.value = (cost / qty).toFixed(2);
      } else {
        out.value = '';
      }
    }
  </script>
</body>
</html>
